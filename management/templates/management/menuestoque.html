{% extends 'management/base.html' %}

{% block content %}
  <section class="py-5">
    <div class="container">
      <h1 class="display-4 text-center">Estoque</h1>
      <div class="row justify-content-center mt-4">
        <!-- Botões para cadastro e visualização -->
        <div class="col-lg-4">
          <a href="{% url 'adicionarestoque' %}" class="btn btn-primary btn-block py-4 px-5 mb-3">
            <i class="fas fa-box-open fa-3x mb-3"></i><br> ADICIONAR AO ESTOQUE
          </a>
        </div>
        <div class="col-lg-4">
          <a href="{% url 'cadastraritem' %}" class="btn btn-success btn-block py-4 px-5 mb-3">
            <i class="fas fa-plus-circle fa-3x mb-3"></i><br> ADICIONAR NOVO ITEM
          </a>
        </div>
        <div class="col-lg-4">
          <a href="#" class="btn btn-warning btn-block py-3 px-4 mb-3">
            <h2 class="display-4 mb-1">{{ itensperdidoextraviado.count }}</h2>
            <p class="mb-2">ITENS PERDIDOS/EXTRAVIADOS</p>
          </a>
        </div>
      </div>

      <!-- Mensagem sobre a deleção de um item -->
      {% if erro %}
        <div class="alert alert-danger text-center">
          <h3 class="mb-0">{{ erro }}</h3>
        </div>
      {% elif confirmacao %}
      <div class="alert alert-success text-center">
        <h3 class="mb-0">{{ confirmacao }}</h3>
      </div>
      {% endif %}

      <!-- Apresentação dos itens no estoque com as opções de edição e deleção -->
      <div class="row justify-content-center mt-3">
        {% for itemestoque in itensestoque %}
          <div class="col-lg-4">
            <div class="card mb-4">
              <div class="card-header text-center bg-dark text-white">
                <h2 class="my-2">{{ itemestoque.item.nome }}</h2>
              </div>
              <div class="card-body text-center">
                <div class="card-title">
                  <h3 class="display-5">{{ itemestoque.quantidade }}</h3>
                </div>
                <p class="mb-1">unidades no estoque</p>
              </div>
              <div class="card-footer text-center">
                <a href="{% url 'editaritem' itemestoque.id %}" class="btn btn-warning mr-3"><i class="fas fa-pencil-alt"></i> Editar Item</a>
                <button class="btn btn-danger" data-toggle="modal" data-target="#itemModal-{{ itemestoque.item_id }}"><i class="fas fa-trash"></i> Deletar Item</button>
              </div>
            </div>
          </div>

          <div class="modal fade text-dark" id="itemModal-{{ itemestoque.item_id }}">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Atenção!</h5>
                  <button class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body text-center">
                  <p class="mb-0">Você tem certeza que quer deletar o item {{ itemestoque.item.nome }}?</p>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-danger mr-3" data-dismiss="modal">Não</button>
                  <form method="POST">
                    {% csrf_token %}
                    <input type="text" class="d-none" name="item" value="{{ itemestoque.item_id }}">
                    <button type="submit" class="btn btn-primary">Sim</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- Modal Deleção de Item -->
{% endblock %}
